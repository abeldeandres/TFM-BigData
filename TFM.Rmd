---
title: "TFM"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##PREPARACION


```{r , echo=FALSE}
CRASH_data_1 <- read.csv("C:/Users/Marta.Rodriguez/Desktop/OneDrive/TFM/CRASH_data-1.csv",na.strings=c("","NA"))
datos.modelo <- subset(CRASH_data_1, select = 
                         c(SEX,AGE,EO_Cause,EO_Major.EC.injury,GCS_EYE,GCS_MOTOR,GCS_VERBAL,
                           PUPIL_REACT_LEFT,PUPIL_REACT_RIGHT,EO_Head.CT.scan,EO_1.or.more.PH,
                           EO_Subarachnoid.bleed,EO_Obliteration.3rdVorBC,
                           EO_Midline.shift..5mm,EO_Non.evac.haem,EO_Evac.haem,EO_Outcome,
                           EO_Symptoms,TH_Major.EC.injury,TH_Head.CT.scan,TH_1.or.more.PH,TH_Subarachnoid.bleed,
                           TH_Obliteration.3rdVorBC,TH_Midline.shift..5mm,TH_Non.evac.haem,TH_Evac.haem,TH_Outcome,TH_Symptoms,GOS5,GOS8))
```

###FASE I: Clasificación entre: ALIVE, DEATH, NO-DATA y MD/GR
* **En esta fase, se ha realizado una clasificacion de los datos dados según 4 resultados finales:**

  + Fallecidos o con discapacidades severas (SD-D)
  + Con discapacidad moderada o buena recuperacion (MR-GR)
  + Vivos (pero sin resultados finales)
  + Sin datos

* **Para este procesado se han tenido en cuenta principalmente las siguientes variables:**

  + EO_Outcome
  + EO_Symptoms
  + TH_Outcome
  + TH_Symptoms
  + GOS5
  + GOS8
  
  ```{r , echo=FALSE}

    datos.modelo$outcome<-NA
    datos.modelo$outcome[which(!is.na(datos.modelo$GOS5))]<-as.character(datos.modelo$GOS5[which(!is.na(datos.modelo$GOS5))])
    datos.modelo$outcome[which(!is.na(datos.modelo$GOS8))]<-as.character(datos.modelo$GOS8[which(!is.na(datos.modelo$GOS8))])
  
  ```
#### Cuando las variables de GOS5 y GOS8 **tienen** datos
* Si las filas ya contenian datos en las columnas de GOS5 y GOS8, directamente se han clasificado -segun estas variables-. De lo contrario, se ha tenido que analizar las otras variables.
```{r }
head(datos.modelo[,c(17,18,27,28,29,30)])
```

#### Cuando las variables de GOS5 y GOS8 **no tienen** datos
* Si las variables de Outcome contenian el valor de 1 (fallecimiento) o las variables de Symptoms contenian el valor de 6, directamente esas filas del dataset pasaban a clasificarse como fallecidos.
```{r ,echo=FALSE}
datos.modelo$outcome[which(datos.modelo$EO_Outcome=="1")]<-"D"
datos.modelo$outcome[which(datos.modelo$EO_Symptoms=="6")]<-"D"
datos.modelo$outcome[which(datos.modelo$TH_Outcome=="1")]<-"D"
datos.modelo$outcome[which(datos.modelo$TH_Symptoms=="6")]<-"D"

head(datos.modelo[which(datos.modelo$EO_Outcome=="1" & is.na(datos.modelo$GOS5) & is.na(datos.modelo$GOS8)),c(17,18,27,28,29,30,31)])
```

* Si las variables de Outcome contenian el valor de 4 (alta) y las de Symptoms el valor de 1, entonces se han clasificado como "Vivos (pero sin resultados finales)".
```{r ,echo=FALSE}
datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$TH_Outcome=="4" & datos.modelo$TH_Symptoms=="1")]<-"ALIVE"
datos.modelo$outcome[which(is.na(datos.modelo$outcome) & is.na(datos.modelo$TH_Symptoms)& is.na(datos.modelo$TH_Outcome) & datos.modelo$EO_Outcome=="4" & datos.modelo$EO_Symptoms=="1")]<-"ALIVE"

head(datos.modelo[which(datos.modelo$EO_Outcome=="4" & datos.modelo$EO_Symptoms=="1" & is.na(datos.modelo$GOS5) & is.na(datos.modelo$GOS8)),c(17,18,27,28,29,30,31)])
```

* Se clasificaran como "Sin datos" todas aquellas filas que no contengan valores ni en las columnas de Symptomps. Se tienen en cuenta los transferidos a otros hospitales.
```{r ,echo=FALSE}
head(datos.modelo[which(is.na(datos.modelo$EO_Symptoms) & is.na(datos.modelo$outcome) ),c(17,18,27,28,29,30,31)])

datos.modelo$outcome[which(is.na(datos.modelo$outcome) & is.na(datos.modelo$TH_Symptoms)& is.na(datos.modelo$EO_Symptoms))]<-"NODATA"

datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$EO_Outcome=="2" & is.na(datos.modelo$TH_Outcome))]<-"NODATA" 

```


* Si los Symptoms son de 4 o de 5 (Discapacidad Severa), entonces se clasificaran como "Fallecidos o con discapacidades severas"
```{r ,echo=FALSE}
head(datos.modelo[which((is.na(datos.modelo$outcome) & datos.modelo$EO_Symptoms=="5")),c(17,18,27,28,29,30,31)])


datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$TH_Symptoms=="5")]<-"D"
datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$TH_Symptoms=="4")]<-"D"
datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$EO_Symptoms=="5"& is.na(datos.modelo$TH_Outcome))]<-"D"
datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$EO_Symptoms=="4"& is.na(datos.modelo$TH_Outcome))]<-"D"

```

* Asi mismo, si las variables de Outcome contenian el valor de 4 y las de Symptoms el valor de 9, significa que el paciente ha sido dado de alta, pero no se tiene ningun dato sobre el estado final, por lo tanto, se han incluido en la clasificacion de "Vivos (pero sin resultados finales)".
```{r ,echo=FALSE}
head(datos.modelo[which(datos.modelo$EO_Outcome=="4" & datos.modelo$EO_Symptoms=="9" & is.na(datos.modelo$outcome) & !is.na(datos.modelo$EO_Outcome)),c(17,18,27,28,29,30,31)])

datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$EO_Outcome=="4" & datos.modelo$EO_Symptoms=="9"& is.na(datos.modelo$TH_Symptoms)& is.na(datos.modelo$TH_Outcome))]<-"ALIVE"

datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$TH_Symptoms=="9")]<-"ALIVE"

datos.modelo$outcome[which(is.na(datos.modelo$outcome) & datos.modelo$EO_Symptoms=="9")]<-"ALIVE"

```

* Se han visto 3 elementos de NODATA, cuyos pacientes obtienen un estado de symptoma 4, por lo que se envia a estado de fallecido, son datos anomalos.
```{r ,echo=FALSE}
head(datos.modelo[which(datos.modelo$outcome=="NODATA" & datos.modelo$TH_Symptoms=="4" & !is.na(datos.modelo$outcome) ),c(17,18,27,28,29,30,31)])

datos.modelo$outcome[which(datos.modelo$outcome=="NODATA" & datos.modelo$TH_Symptoms=="4")]<-"D"

```


```{r ,echo=FALSE}
datos.modelo$outcome[which(datos.modelo$outcome=="D")] <- "D"
datos.modelo$outcome[which(datos.modelo$outcome=="SD")] <- "D"
datos.modelo$outcome[which(datos.modelo$outcome=="SD-")] <- "D"
datos.modelo$outcome[which(datos.modelo$outcome=="SD*")] <- "D"
datos.modelo$outcome[which(datos.modelo$outcome=="SD+")] <- "D"
datos.modelo$outcome[which(datos.modelo$outcome=="GR")] <- "MDGR"
datos.modelo$outcome[which(datos.modelo$outcome=="GR-")] <- "MDGR"
datos.modelo$outcome[which(datos.modelo$outcome=="GR+")] <- "MDGR"
datos.modelo$outcome[which(datos.modelo$outcome=="MD")] <- "MDGR"
datos.modelo$outcome[which(datos.modelo$outcome=="MD-")] <- "MDGR"
datos.modelo$outcome[which(datos.modelo$outcome=="MD+")] <- "MDGR"

```

#### DATOS FINALES:
* Fallecidos o con discapacidades severas
```{r ,echo=FALSE}
NROW(datos.modelo$outcome[which(datos.modelo$outcome=="D")])

```
* Con discapacidad moderada o buena recuperacion
```{r ,echo=FALSE}
NROW(datos.modelo$outcome[which(datos.modelo$outcome=="MDGR")])

```
* Vivos (pero sin resultados finales)
```{r ,echo=FALSE}
NROW(datos.modelo$outcome[which(datos.modelo$outcome=="ALIVE")])

```
* Sin datos
```{r ,echo=FALSE}
NROW(datos.modelo$outcome[which(datos.modelo$outcome=="NODATA")])

```
* Con NA 
```{r ,echo=FALSE}
NROW(datos.modelo$outcome[which(is.na(datos.modelo$outcome))])

```
###FASE II: Clasificación entre: ESCANEADOS y NO ESCANEADOS


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
